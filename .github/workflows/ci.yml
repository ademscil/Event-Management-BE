name: CI

on:
  push:
    branches:
      - development
      - main
  pull_request:
    branches:
      - development
      - main

jobs:
  test:
    runs-on: ubuntu-latest
    env:
      NODE_ENV: test
      PORT: 3000
      BASE_URL: http://localhost:3000
      DB_SERVER: localhost
      DB_USER: test_user
      DB_PASSWORD: test_password
      DB_NAME: CSI_TEST
      DB_PORT: 1433
      DB_ENCRYPT: false
      DB_TRUST_SERVER_CERTIFICATE: true
      JWT_SECRET: test-secret-key-at-least-32-characters
      JWT_EXPIRATION: 8h
      JWT_REFRESH_EXPIRATION: 7d
      SESSION_TIMEOUT_MINUTES: 30
      SESSION_MAX_DURATION_HOURS: 8
      RATE_LIMIT_WINDOW_MS: 900000
      RATE_LIMIT_MAX_REQUESTS: 100
      CORS_ORIGIN: "*"

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: Install dependencies
        run: npm install

      - name: Run lint (optional)
        run: npm run lint --if-present

      - name: Run tests (CI profile)
        run: npm run test:ci
